# NATS Server Configuration for Armoricore Production
# Generated for production deployment - January 21, 2026

# Basic server configuration
listen: "0.0.0.0:4222"
http: "0.0.0.0:8222"

# Server information
server_name: "armoricore-nats-01"
server_tags: ["armoricore", "production"]

# Authentication - using token-based auth for security
authorization {
  token: "armoricore-production-token-2026"
  # For production, consider using:
  # users: [
  #   {user: armoricore, password: secure-password}
  # ]
  # Or integrate with your identity provider
}

# Clustering configuration for high availability
cluster {
  listen: "0.0.0.0:6222"
  # In production, specify routes to other cluster nodes:
  # routes: [
  #   "nats://nats-02.armoricore.com:6222",
  #   "nats://nats-03.armoricore.com:6222"
  # ]

  # Cluster authentication
  authorization {
    token: "armoricore-cluster-token-2026"
  }
}

# JetStream configuration for persistent messaging and streams
jetstream {
  # Storage directory - ensure proper permissions and backups
  store_dir: "/opt/nats/jetstream"

  # Memory and file storage limits
  max_memory: 1GB
  max_file: 10GB

  # Domain for multi-tenant deployments
  domain: "armoricore"

  # Enable JetStream extensions
  extensions: {
    # Allow stream creation via client requests
    allow_direct_stream_create: true
  }
}

# Logging configuration
logfile: "/var/log/nats/nats.log"
logfile_size_limit: 100MB

# Enable system account for monitoring
system_account: "SYS"

# TLS configuration (uncomment when certificates are available)
# tls {
#   cert_file: "/etc/nats/certs/server.pem"
#   key_file: "/etc/nats/certs/server-key.pem"
#   ca_file: "/etc/nats/certs/ca.pem"
#   verify: true
#   timeout: 2
# }

# WebSocket configuration for browser clients
websocket {
  listen: "0.0.0.0:9222"
  # TLS for WebSocket connections
  # tls: {
  #   cert_file: "/etc/nats/certs/server.pem"
  #   key_file: "/etc/nats/certs/server-key.pem"
  # }
  # Authentication for WebSocket
  authorization {
    token: "armoricore-ws-token-2026"
  }
}

# Monitoring and metrics
# Enable Prometheus metrics export
server_tags: ["armoricore", "production", "nats"]

# Leaf node configuration (for connecting to other NATS deployments)
# leafnodes {
#   listen: "0.0.0.0:7422"
# }

# Gateway configuration (for connecting to other NATS superclusters)
# gateway {
#   name: "armoricore-gateway"
#   listen: "0.0.0.0:7522"
# }

# Performance tuning
max_payload: 1048576  # 1MB max payload
max_connections: 10000  # Maximum concurrent connections
ping_interval: 60s     # Ping interval for connection health
max_pings_out: 3       # Maximum missed pings before disconnect
write_deadline: 5s     # Write deadline for slow clients

# Enable profiling for debugging (disable in production)
# profiler {
#   listen: "0.0.0.0:65432"
# }